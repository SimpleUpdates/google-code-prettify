<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Code Prettifier</title>
<script src="../src/prettify.js" type="text/javascript"
 onerror="alert('Error: failed to load ' + this.src)"></script>
<link rel="stylesheet" type="text/css" href="../src/prettify.css" />
<style type="text/css">
.mismatch { background: #fee; }
</style>
</head>

<body onload="prettyPrint(); setTimeout(runTests, 1000/*ms*/)" bgcolor="white">
<div id="errorReport" style="white-space: pre"></div>

<h1>Bash</h1>
<pre class="prettyprint" id="bash">#!/bin/bash

# Fibonacci numbers
# param int n >= 0
# returns int >= 0
function fib() {
  local n=$(( $1 + 0 ))
  shift
  local a=1
  local b=1
  while [ "$n" != 0 ] ; do
    local tmp=$a
    a=$(( $a + $b ))
    b=$tmp
    n=$(( $n - 1 ))
  done
  echo -n $a
}

fib 10
</pre>

<h1>C</h1>

<pre class="prettyprint" id="C">
#include &lt;stdio.h&gt;

/* the n-th fibonacci number.
 */
unsigned int fib(unsigned int n) {
  unsigned int a = 1, b = 1;
  unsigned int tmp;
  while (--n >= 0) {
    tmp = a;
    a += b;
    b = tmp;
  }
  return a;
}

main() {
  printf("%u", fib(10));
}
</pre>

<h1>C++</h1>
<pre class="prettyprint" id="Cpp">
#include &lt;iostream&gt;

using namespace std;

//! fibonacci numbers with gratuitous use of templates.
//! \param n an index into the fibonacci series
//! \param fib0 element 0 of the series
//! \return the nth element of the fibonacci series
template &lt;class T>
T fib(unsigned int n, const T&amp; fib0) {
  T a(fib0), b(fib0);
  while (--n &gt;= 0) {
    T tmp(a);
    a += b;
    b = tmp;
  }
  return a;
}

int main(int argc, char **argv) {
  cout &lt;&lt; fib(10, 1U);
}
</pre>

<h1>Java</h1>
<pre class="prettyprint" id="java">
package foo;

import java.util.Iterator;

/**
 * the fibonacci series implemented as an Iterable.
 */
public final class Fibonacci implements Iterable&lt;Integer> {
  /** the next and previous members of the series. */
  private int a = 1, b = 1;

  public Iterator&lt;Integer> iterator() {
    return new Iterator&lt;Integer>() {
      /** the series is infinite. */
      public boolean hasNext() { return true; }
      public Integer next() {
        int tmp = a;
        a += b;
        b = tmp;
        return a;
      }
      public void remove() { throw new UnsupportedOperationException(); }
    };
  }

  /**
   * the n&lt;sup>th&lt;/sup> element of the given series.
   * @throws NoSuchElementException if there are less than n elements in the
   *   given Iterable's {@link Iterable#iterator iterator}.
   */
  public static &lt;T>
  T nth(int n, Iterable&lt;T> iterable) {
    Iterator&lt;? extends T> it = iterable.iterator();
    while (--n > 0) {
      it.next();
    }
    return it.next();
  }

  public static void main(String[] args) {
    System.out.print(nth(10, new Fibonacci()));
  }
}
</pre>

<h1>Javascript</h1>
<pre class="prettyprint" id="javascript">
/**
 * nth element in the fibonacci series.
 * @param n >= 0
 * @return the nth element, >= 0.
 */
function fib(n) {
  var a = 1, b = 1;
  var tmp;
  while (--n >= 0) {
    tmp = a;
    a += b;
    b = tmp;
  }
  return a;
}

document.write(fib(10));
</pre>

<h1>Perl</h1>
<pre class="prettyprint" id="perl">
#!/usr/bin/perl

use strict;
use integer;

# the nth element of the fibonacci series
# param n - an int >= 0
# return an int >= 0
sub fib($) {
  my $n = shift, $a = 1, $b = 1;
  ($a, $b) = ($a + $b, $a) until (--$n < 0);
  return $a;
}

print fib(10);
</pre>

<h1>Python</h1>
<pre class="prettyprint" id="python">
#!/usr/bin/python2.4

def fib():
  '''
  a generator that produces the elements of the fibonacci series
  '''

  a = 1
  b = 1
  while True:
    a, b = a + b, a
    yield a

def nth(series, n):
  '''
  returns the nth element of a series,
  consuming the earlier elements of the series
  '''

  for x in series:
    n = n - 1
    if n <= 0: return x

print nth(fib(), 10)
</pre>

<h1>XML</h1>
<pre class="prettyprint" id="xml">
&lt;!DOCTYPE series PUBLIC "fibonacci numbers"&gt;

&lt;series base="1" step="s(n-2) + s(n-1)">
  &lt;element i="0"&gt;1&lt;/element&gt;
  &lt;element i="1"&gt;1&lt;/element&gt;
  &lt;element i="2"&gt;2&lt;/element&gt;
  &lt;element i="3"&gt;3&lt;/element&gt;
  &lt;element i="4"&gt;5&lt;/element&gt;
  &lt;element i="5"&gt;8&lt;/element&gt;
  ...
&lt;/series&gt;
</pre>

<h1>HTML</h1>
<pre class="prettyprint" id="html">
&lt;html&gt;
  &lt;head>
    &lt;title&gt;Fibonacci number&lt;/title&gt;
  &lt;/head&gt;
  &lt;body>
    &lt;noscript&gt;
      &lt;dl&gt;
        &lt;dt&gt;Fibonacci numbers&lt;/dt&gt;
        &lt;dd&gt;1&lt;/dd&gt;
        &lt;dd&gt;1&lt;/dd&gt;
        &lt;dd&gt;2&lt;/dd&gt;
        &lt;dd&gt;3&lt;/dd&gt;
        &lt;dd&gt;5&lt;/dd&gt;
        &lt;dd&gt;8&lt;/dd&gt;
        &amp;hellip;
      &lt;/dl&gt;
    &lt;/noscript&gt;

    &lt;script type="text/javascript">&lt;!--
function fib(n) {
  var a = 1, b = 1;
  var tmp;
  while (--n >= 0) {
    tmp = a;
    a += b;
    b = tmp;
  }
  return a;
}

document.writeln(fib(10));
// -->
    &lt;/script>
  &lt;/body&gt;
&lt;/html&gt;
</pre>

<h1>HTML using XMP</h1>
<xmp class="prettyprint" id="htmlXmp"
><html>
  <head>
    <title>Fibonacci number</title>
  </head>
  <body>
    <noscript>
      <dl>
        <dt>Fibonacci numbers</dt>
        <dd>1</dd>
        <dd>1</dd>
        <dd>2</dd>
        <dd>3</dd>
        <dd>5</dd>
        <dd>8</dd>
        &hellip;
      </dl>
    </noscript>

    <script type="text/javascript"><!--
function fib(n) {
  var a = 1, b = 1;
  var tmp;
  while (--n >= 0) {
    tmp = a;
    a += b;
    b = tmp;
  }
  return a;
}

document.writeln(fib(10));
// -->
    </script>
  </body>
</html>
</xmp>

</body>

<script type="text/javascript">
/**
 * maps ids of rewritten code to the expected output.
 * For brevity, <span class="foo"> has been changed to `FOO and close span tags
 * have been changed to `END.
 */
var goldens = {
  bash: (
      '`COM#!/bin/bash`END`PLN<br>' +
      '<br>' +
      '`END`COM# Fibonacci numbers`END`PLN<br>' +
      '`END`COM# param int n &gt;= 0`END`PLN<br>' +
      '`END`COM# returns int &gt;= 0`END`PLN<br>' +
      '`END`KWDfunction`END`PLN fib`END`PUN()`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; local n`END`PUN=`END`PLN$`END`PUN((`END`PLN $1 `END`PUN+' +
          '`END`PLN `END`LIT0`END`PLN `END`PUN))`END`PLN<br>' +
      '&nbsp; shift<br>' +
      '&nbsp; local a`END`PUN=`END`LIT1`END`PLN<br>' +
      '&nbsp; local b`END`PUN=`END`LIT1`END`PLN<br>' +
      '&nbsp; `END`KWDwhile`END`PLN `END`PUN[`END`PLN `END`STR"$n"`END' +
          '`PLN `END`PUN!=`END`PLN `END`LIT0`END`PLN `END`PUN]`END`PLN `END' +
          '`PUN;`END`PLN `END`KWDdo`END`PLN<br>' +
      '&nbsp; &nbsp; local tmp`END`PUN=`END`PLN$a<br>' +
      '&nbsp; &nbsp; a`END`PUN=`END`PLN$`END`PUN((`END`PLN $a `END`PUN+`END' +
          '`PLN $b `END`PUN))`END`PLN<br>' +
      '&nbsp; &nbsp; b`END`PUN=`END`PLN$tmp<br>' +
      '&nbsp; &nbsp; n`END`PUN=`END`PLN$`END`PUN((`END`PLN $n `END`PUN-`END' +
          '`PLN `END`LIT1`END`PLN `END`PUN))`END`PLN<br>' +
      '&nbsp; done<br>' +
      '&nbsp; echo `END`PUN-`END`PLNn $a<br>' +
      '`END`PUN}`END`PLN<br>' +
      '<br>' +
      'fib `END`LIT10`END'),

  C: (
      '`COM#include &lt;stdio.h&gt;`END`PLN<br>' +
      '<br>' +
      '`END`COM/* the n-th fibonacci number.<br>' +
      '&nbsp;*/`END`PLN<br>' +
      '`END`KWDunsigned`END`PLN `END`KWDint`END`PLN fib`END`PUN(`END' +
          '`KWDunsigned`END`PLN `END`KWDint`END`PLN n`END`PUN)`END`PLN `END' +
          '`PUN{`END`PLN<br>' +
      '&nbsp; `END`KWDunsigned`END`PLN `END`KWDint`END`PLN a `END`PUN=`END' +
          '`PLN `END`LIT1`END`PUN,`END`PLN b `END`PUN=`END`PLN `END`LIT1`END' +
          '`PUN;`END`PLN<br>' +
      '&nbsp; `END`KWDunsigned`END`PLN `END`KWDint`END`PLN tmp`END`PUN;`END' +
          '`PLN<br>' +
      '&nbsp; `END`KWDwhile`END`PLN `END`PUN(--`END`PLNn `END&gt;`PUN=`END' +
          '`PLN `END`LIT0`END`PUN)`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; &nbsp; tmp `END`PUN=`END`PLN a`END`PUN;`END`PLN<br>' +
      '&nbsp; &nbsp; a `END`PUN+=`END`PLN b`END`PUN;`END`PLN<br>' +
      '&nbsp; &nbsp; b `END`PUN=`END`PLN tmp`END`PUN;`END`PLN<br>' +
      '&nbsp; `END`PUN}`END`PLN<br>' +
      '&nbsp; `END`KWDreturn`END`PLN a`END`PUN;`END`PLN<br>' +
      '`END`PUN}`END`PLN<br>' +
      '<br>' +
      'main`END`PUN()`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; printf`END`PUN(`END`STR"%u"`END`PUN,`END`PLN fib`END`PUN(`END' +
          '`LIT10`END`PUN));`END`PLN<br>' +
      '`END`PUN}`END'),

  Cpp: (
      '`COM#include &lt;iostream&gt;`END`PLN<br>' +
      '<br>' +
      '`END`KWDusing`END`PLN `END`KWDnamespace`END`PLN std`END`PUN;`END' +
          '`PLN<br>' +
      '<br>' +
      '`END`COM//! fibonacci numbers with gratuitous use of templates.`END' +
          '`PLN<br>' +
      '`END`COM//! \\param n an index into the fibonacci series`END`PLN<br>' +
      '`END`COM//! \\param fib0 element 0 of the series`END`PLN<br>' +
      '`END`COM//! \\return the nth element of the fibonacci series`END' +
          '`PLN<br>' +
      '`END`KWDtemplate`END`PLN `END&lt;`KWDclass`END`PLN T`END&gt;`PLN<br>' +
      'T fib`END`PUN(`END`KWDunsigned`END`PLN `END`KWDint`END`PLN n`END' +
          '`PUN,`END`PLN `END`KWDconst`END`PLN T`END&amp;`PLN fib0`END' +
          '`PUN)`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; T a`END`PUN(`END`PLNfib0`END`PUN),`END`PLN b`END`PUN(`END' +
          '`PLNfib0`END`PUN);`END`PLN<br>' +
      '&nbsp; `END`KWDwhile`END`PLN `END`PUN(--`END`PLNn `END&gt;`PUN=`END' +
          '`PLN `END`LIT0`END`PUN)`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; &nbsp; T tmp`END`PUN(`END`PLNa`END`PUN);`END`PLN<br>' +
      '&nbsp; &nbsp; a `END`PUN+=`END`PLN b`END`PUN;`END`PLN<br>' +
      '&nbsp; &nbsp; b `END`PUN=`END`PLN tmp`END`PUN;`END`PLN<br>' +
      '&nbsp; `END`PUN}`END`PLN<br>' +
      '&nbsp; `END`KWDreturn`END`PLN a`END`PUN;`END`PLN<br>' +
      '`END`PUN}`END`PLN<br>' +
      '<br>' +
      '`END`KWDint`END`PLN main`END`PUN(`END`KWDint`END`PLN argc`END' +
          '`PUN,`END`PLN `END`KWDchar`END`PLN `END`PUN**`END`PLNargv`END' +
          '`PUN)`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; cout `END&lt;&lt;`PLN fib`END`PUN(`END`LIT10`END`PUN,`END' +
          '`PLN `END`LIT1U`END`PUN);`END`PLN<br>' +
      '`END`PUN}`END'),

  java: (
      '`KWDpackage`END`PLN foo`END`PUN;`END`PLN<br>' +
      '<br>' +
      '`END`KWDimport`END`PLN java`END`PUN.`END`PLNutil`END`PUN.`END' +
          '`TYPIterator`END`PUN;`END`PLN<br>' +
      '<br>' +
      '`END`COM/**<br>' +
      '&nbsp;* the fibonacci series implemented as an Iterable.<br>' +
      '&nbsp;*/`END`PLN<br>' +
      '`END`KWDpublic`END`PLN `END`KWDfinal`END`PLN `END`KWDclass`END' +
          '`PLN `END`TYPFibonacci`END`PLN `END`KWDimplements`END`PLN `END' +
          '`TYPIterable`END&lt;`TYPInteger`END&gt;`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; `END' +
          '`COM/** the next and previous members of the series. */`END' +
          '`PLN<br>' +
      '&nbsp; `END`KWDprivate`END`PLN `END`KWDint`END`PLN a `END`PUN=`END' +
          '`PLN `END`LIT1`END`PUN,`END`PLN b `END`PUN=`END`PLN `END`LIT1`END' +
          '`PUN;`END`PLN<br>' +
      '<br>' +
      '&nbsp; `END`KWDpublic`END`PLN `END`TYPIterator`END&lt;`TYPInteger`END' +
          '&gt;`PLN iterator`END`PUN()`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; &nbsp; `END`KWDreturn`END`PLN `END`KWDnew`END`PLN `END' +
          '`TYPIterator`END&lt;`TYPInteger`END&gt;`PUN()`END`PLN `END' +
          '`PUN{`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; `END`COM/** the series is infinite. */`END' +
          '`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; `END`KWDpublic`END`PLN `END`KWDboolean`END' +
          '`PLN hasNext`END`PUN()`END`PLN `END`PUN{`END`PLN `END' +
          '`KWDreturn`END`PLN `END`KWDtrue`END`PUN;`END`PLN `END`PUN}`END' +
          '`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; `END`KWDpublic`END`PLN `END`TYPInteger`END' +
          '`PLN `END`KWDnext`END`PUN()`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`KWDint`END`PLN tmp `END`PUN=`END' +
          '`PLN a`END`PUN;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; a `END`PUN+=`END`PLN b`END`PUN;`END' +
          '`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; b `END`PUN=`END`PLN tmp`END`PUN;`END' +
          '`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`KWDreturn`END`PLN a`END`PUN;`END' +
          '`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; `END`PUN}`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; `END`KWDpublic`END`PLN `END`KWDvoid`END' +
          '`PLN remove`END`PUN()`END`PLN `END`PUN{`END`PLN `END`KWDthrow`END' +
          '`PLN `END`KWDnew`END`PLN `END' +
          '`TYPUnsupportedOperationException`END`PUN();`END`PLN `END' +
          '`PUN}`END`PLN<br>' +
      '&nbsp; &nbsp; `END`PUN};`END`PLN<br>' +
      '&nbsp; `END`PUN}`END`PLN<br>' +
      '<br>' +
      '&nbsp; `END`COM/**<br>' +
      '&nbsp; &nbsp;* the n&lt;sup&gt;th&lt;/sup&gt; element of the given ' +
          'series.<br>' +
      '&nbsp; &nbsp;* @throws NoSuchElementException if there are less than ' +
          'n elements in the<br>' +
      '&nbsp; &nbsp;* &nbsp; given Iterable\'s {@link Iterable#iterator ' +
          'iterator}.<br>' +
      '&nbsp; &nbsp;*/`END`PLN<br>' +
      '&nbsp; `END`KWDpublic`END`PLN `END`KWDstatic`END`PLN `END' +
          '&lt;`PLNT`END&gt;`PLN<br>' +
      '&nbsp; T nth`END`PUN(`END`KWDint`END`PLN n`END`PUN,`END`PLN `END' +
          '`TYPIterable`END&lt;`PLNT`END&gt;`PLN iterable`END`PUN)`END' +
          '`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; &nbsp; `END`TYPIterator`END&lt;`PUN?`END`PLN `END' +
          '`KWDextends`END`PLN T`END&gt;`PLN it `END`PUN=`END' +
          '`PLN iterable`END`PUN.`END`PLNiterator`END`PUN();`END`PLN<br>' +
      '&nbsp; &nbsp; `END`KWDwhile`END`PLN `END`PUN(--`END`PLNn `END' +
          '&gt;`PLN `END`LIT0`END`PUN)`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; it`END`PUN.`END`KWDnext`END`PUN();`END`PLN<br>' +
      '&nbsp; &nbsp; `END`PUN}`END`PLN<br>' +
      '&nbsp; &nbsp; `END`KWDreturn`END`PLN it`END`PUN.`END`KWDnext`END' +
          '`PUN();`END`PLN<br>' +
      '&nbsp; `END`PUN}`END`PLN<br>' +
      '<br>' +
      '&nbsp; `END`KWDpublic`END`PLN `END`KWDstatic`END`PLN `END`KWDvoid`END' +
          '`PLN main`END`PUN(`END`TYPString`END`PUN[]`END`PLN args`END' +
          '`PUN)`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; &nbsp; `END`TYPSystem`END`PUN.`END`PLNout`END`PUN.`END' +
          '`KWDprint`END`PUN(`END`PLNnth`END`PUN(`END`LIT10`END`PUN,`END' +
          '`PLN `END`KWDnew`END`PLN `END`TYPFibonacci`END`PUN()));`END' +
          '`PLN<br>' +
      '&nbsp; `END`PUN}`END`PLN<br>' +
      '`END`PUN}`END'),
  javascript: (
      '`COM/**<br>' +
      '&nbsp;* nth element in the fibonacci series.<br>' +
      '&nbsp;* @param n &gt;= 0<br>' +
      '&nbsp;* @return the nth element, &gt;= 0.<br>' +
      '&nbsp;*/`END`PLN<br>' +
      '`END`KWDfunction`END`PLN fib`END`PUN(`END`PLNn`END`PUN)`END`PLN `END' +
          '`PUN{`END`PLN<br>' +
      '&nbsp; `END`KWDvar`END`PLN a `END`PUN=`END`PLN `END`LIT1`END`PUN,`END' +
          '`PLN b `END`PUN=`END`PLN `END`LIT1`END`PUN;`END`PLN<br>' +
      '&nbsp; `END`KWDvar`END`PLN tmp`END`PUN;`END`PLN<br>' +
      '&nbsp; `END`KWDwhile`END`PLN `END`PUN(--`END`PLNn `END&gt;`PUN=`END' +
          '`PLN `END`LIT0`END`PUN)`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; &nbsp; tmp `END`PUN=`END`PLN a`END`PUN;`END`PLN<br>' +
      '&nbsp; &nbsp; a `END`PUN+=`END`PLN b`END`PUN;`END`PLN<br>' +
      '&nbsp; &nbsp; b `END`PUN=`END`PLN tmp`END`PUN;`END`PLN<br>' +
      '&nbsp; `END`PUN}`END`PLN<br>' +
      '&nbsp; `END`KWDreturn`END`PLN a`END`PUN;`END`PLN<br>' +
      '`END`PUN}`END`PLN<br>' +
      '<br>' +
      'document`END`PUN.`END`PLNwrite`END`PUN(`END`PLNfib`END`PUN(`END' +
          '`LIT10`END`PUN));`END'),
  perl: (
      '`COM#!/usr/bin/perl`END`PLN<br>' +
      '<br>' +
      '`END`KWDuse`END`PLN strict`END`PUN;`END`PLN<br>' +
      '`END`KWDuse`END`PLN integer`END`PUN;`END`PLN<br>' +
      '<br>' +
      '`END`COM# the nth element of the fibonacci series`END`PLN<br>' +
      '`END`COM# param n - an int &gt;= 0`END`PLN<br>' +
      '`END`COM# return an int &gt;= 0`END`PLN<br>' +
      '`END`KWDsub`END`PLN fib`END`PUN(`END`PLN$`END`PUN)`END`PLN `END' +
          '`PUN{`END`PLN<br>' +
      '&nbsp; my $n `END`PUN=`END`PLN shift`END`PUN,`END`PLN ' +
      '$a `END`PUN=`END`PLN `END`LIT1`END`PUN,`END`PLN $b `END' +
          '`PUN=`END`PLN `END`LIT1`END`PUN;`END`PLN<br>' +
      '&nbsp; `END`PUN(`END`PLN$a`END`PUN,`END`PLN $b`END`PUN)`END' +
          '`PLN `END`PUN=`END`PLN `END`PUN(`END`PLN$a `END`PUN+`END' +
          '`PLN $b`END`PUN,`END`PLN $a`END`PUN)`END`PLN `END`KWDuntil`END' +
          '`PLN `END`PUN(--`END`PLN$n `END&lt;`PLN `END`LIT0`END`PUN);`END' +
          '`PLN<br>' +
      '&nbsp; `END`KWDreturn`END`PLN $a`END`PUN;`END`PLN<br>' +
      '`END`PUN}`END`PLN<br>' +
      '<br>' +
      '`END`KWDprint`END`PLN fib`END`PUN(`END`LIT10`END`PUN);`END'),
  python: (
      '`COM#!/usr/bin/python2.4`END`PLN<br>' +
      '<br>' +
      '`END`KWDdef`END`PLN fib`END`PUN():`END`PLN<br>' +
      '&nbsp; `END`STR\'\'\'<br>' +
      '&nbsp; a generator that produces the elements of the fibonacci series' +
          '<br>' +
      '&nbsp; \'\'\'`END`PLN<br>' +
      '<br>' +
      '&nbsp; a `END`PUN=`END`PLN `END`LIT1`END`PLN<br>' +
      '&nbsp; b `END`PUN=`END`PLN `END`LIT1`END`PLN<br>' +
      '&nbsp; `END`KWDwhile`END`PLN `END`KWDTrue`END`PUN:`END`PLN<br>' +
      '&nbsp; &nbsp; a`END`PUN,`END`PLN b `END`PUN=`END`PLN a `END`PUN+`END' +
          '`PLN b`END`PUN,`END`PLN a<br>' +
      '&nbsp; &nbsp; `END`KWDyield`END`PLN a<br>' +
      '<br>' +
      '`END`KWDdef`END`PLN nth`END`PUN(`END`PLNseries`END`PUN,`END`PLN n`END' +
          '`PUN):`END`PLN<br>' +
      '&nbsp; `END`STR\'\'\'<br>' +
      '&nbsp; returns the nth element of a series,<br>' +
      '&nbsp; consuming the earlier elements of the series<br>' +
      '&nbsp; \'\'\'`END`PLN<br>' +
      '<br>' +
      '&nbsp; `END`KWDfor`END`PLN x `END`KWDin`END`PLN series`END`PUN:`END' +
          '`PLN<br>' +
      '&nbsp; &nbsp; n `END`PUN=`END`PLN n `END`PUN-`END`PLN `END`LIT1`END' +
          '`PLN<br>' +
      '&nbsp; &nbsp; `END`KWDif`END`PLN n `END&lt;`PUN=`END`PLN `END' +
          '`LIT0`END`PUN:`END`PLN `END`KWDreturn`END`PLN x<br>' +
      '<br>' +
      '`END`KWDprint`END`PLN nth`END`PUN(`END`PLNfib`END`PUN(),`END`PLN `END' +
          '`LIT10`END`PUN)`END'),
  xml: (
      '`DEC&lt;!DOCTYPE series PUBLIC "fibonacci numbers"&gt;`END`PLN<br>' +
      '<br>' +
      '`END`TAG&lt;series `END`ATNbase`END`TAG=`END`ATV"1"`END`TAG `END' +
          '`ATNstep`END`TAG=`END`ATV"s(n-2) + s(n-1)"`END`TAG&gt;`END' +
          '`PLN<br>' +
      '&nbsp; `END`TAG&lt;element `END`ATNi`END`TAG=`END`ATV"0"`END' +
          '`TAG&gt;`END`PLN1`END`TAG&lt;/element&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;element `END`ATNi`END`TAG=`END`ATV"1"`END' +
          '`TAG&gt;`END`PLN1`END`TAG&lt;/element&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;element `END`ATNi`END`TAG=`END`ATV"2"`END' +
          '`TAG&gt;`END`PLN2`END`TAG&lt;/element&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;element `END`ATNi`END`TAG=`END`ATV"3"`END' +
          '`TAG&gt;`END`PLN3`END`TAG&lt;/element&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;element `END`ATNi`END`TAG=`END`ATV"4"`END' +
          '`TAG&gt;`END`PLN5`END`TAG&lt;/element&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;element `END`ATNi`END`TAG=`END`ATV"5"`END' +
          '`TAG&gt;`END`PLN8`END`TAG&lt;/element&gt;`END`PLN<br>' +
      '&nbsp; ...<br>' +
      '`END`TAG&lt;/series&gt;`END'),
  html: (
      '`TAG&lt;html&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;head&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; `END`TAG&lt;title&gt;`END`PLNFibonacci number`END' +
          '`TAG&lt;/title&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;/head&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;body&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; `END`TAG&lt;noscript&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; `END`TAG&lt;dl&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dt&gt;`END' +
          '`PLNFibonacci numbers`END`TAG&lt;/dt&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dd&gt;`END`PLN1`END' +
          '`TAG&lt;/dd&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dd&gt;`END`PLN1`END' +
          '`TAG&lt;/dd&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dd&gt;`END`PLN2`END' +
          '`TAG&lt;/dd&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dd&gt;`END`PLN3`END' +
          '`TAG&lt;/dd&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dd&gt;`END`PLN5`END' +
          '`TAG&lt;/dd&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dd&gt;`END`PLN8`END' +
          '`TAG&lt;/dd&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; &amp;hellip;<br>' +
      '&nbsp; &nbsp; &nbsp; `END`TAG&lt;/dl&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; `END`TAG&lt;/noscript&gt;`END`PLN<br>' +
      '<br>' +
      '&nbsp; &nbsp; `END`TAG&lt;script `END`ATNtype`END`TAG=`END' +
          '`ATV"text/javascript"`END`TAG&gt;`END' +
          '<span class="embsrc">&lt;`PUN!--`END`PLN<br>' +
      '`END`KWDfunction`END`PLN fib`END`PUN(`END`PLNn`END`PUN)`END`PLN `END' +
          '`PUN{`END`PLN<br>' +
      '&nbsp; `END`KWDvar`END`PLN a `END`PUN=`END`PLN `END`LIT1`END`PUN,`END' +
          '`PLN b `END`PUN=`END`PLN `END`LIT1`END`PUN;`END`PLN<br>' +
      '&nbsp; `END`KWDvar`END`PLN tmp`END`PUN;`END`PLN<br>' +
      '&nbsp; `END`KWDwhile`END`PLN `END`PUN(--`END`PLNn `END&gt;`PUN=`END' +
          '`PLN `END`LIT0`END`PUN)`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; &nbsp; tmp `END`PUN=`END`PLN a`END`PUN;`END`PLN<br>' +
      '&nbsp; &nbsp; a `END`PUN+=`END`PLN b`END`PUN;`END`PLN<br>' +
      '&nbsp; &nbsp; b `END`PUN=`END`PLN tmp`END`PUN;`END`PLN<br>' +
      '&nbsp; `END`PUN}`END`PLN<br>' +
      '&nbsp; `END`KWDreturn`END`PLN a`END`PUN;`END`PLN<br>' +
      '`END`PUN}`END`PLN<br>' +
      '<br>' +
      'document`END`PUN.`END`PLNwriteln`END`PUN(`END`PLNfib`END`PUN(`END' +
          '`LIT10`END`PUN));`END`PLN<br>' +
      '`END`COM// --&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; `END`END`TAG&lt;/script&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;/body&gt;`END`PLN<br>' +
      '`END`TAG&lt;/html&gt;`END'),
  htmlXmp: (
      '`TAG&lt;html&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;head&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; `END`TAG&lt;title&gt;`END`PLNFibonacci number`END' +
          '`TAG&lt;/title&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;/head&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;body&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; `END`TAG&lt;noscript&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; `END`TAG&lt;dl&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dt&gt;`END' +
          '`PLNFibonacci numbers`END`TAG&lt;/dt&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dd&gt;`END`PLN1`END' +
          '`TAG&lt;/dd&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dd&gt;`END`PLN1`END' +
          '`TAG&lt;/dd&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dd&gt;`END`PLN2`END' +
          '`TAG&lt;/dd&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dd&gt;`END`PLN3`END' +
          '`TAG&lt;/dd&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dd&gt;`END`PLN5`END' +
          '`TAG&lt;/dd&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; `END`TAG&lt;dd&gt;`END`PLN8`END' +
          '`TAG&lt;/dd&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; &nbsp; &nbsp; &amp;hellip;<br>' +
      '&nbsp; &nbsp; &nbsp; `END`TAG&lt;/dl&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; `END`TAG&lt;/noscript&gt;`END`PLN<br>' +
      '<br>' +
      '&nbsp; &nbsp; `END`TAG&lt;script `END`ATNtype`END`TAG=`END' +
          '`ATV"text/javascript"`END`TAG&gt;`END' +
          '<span class="embsrc">&lt;`PUN!--`END`PLN<br>' +
      '`END`KWDfunction`END`PLN fib`END`PUN(`END`PLNn`END`PUN)`END`PLN `END' +
          '`PUN{`END`PLN<br>' +
      '&nbsp; `END`KWDvar`END`PLN a `END`PUN=`END`PLN `END`LIT1`END`PUN,`END' +
          '`PLN b `END`PUN=`END`PLN `END`LIT1`END`PUN;`END`PLN<br>' +
      '&nbsp; `END`KWDvar`END`PLN tmp`END`PUN;`END`PLN<br>' +
      '&nbsp; `END`KWDwhile`END`PLN `END`PUN(--`END`PLNn `END&gt;`PUN=`END' +
          '`PLN `END`LIT0`END`PUN)`END`PLN `END`PUN{`END`PLN<br>' +
      '&nbsp; &nbsp; tmp `END`PUN=`END`PLN a`END`PUN;`END`PLN<br>' +
      '&nbsp; &nbsp; a `END`PUN+=`END`PLN b`END`PUN;`END`PLN<br>' +
      '&nbsp; &nbsp; b `END`PUN=`END`PLN tmp`END`PUN;`END`PLN<br>' +
      '&nbsp; `END`PUN}`END`PLN<br>' +
      '&nbsp; `END`KWDreturn`END`PLN a`END`PUN;`END`PLN<br>' +
      '`END`PUN}`END`PLN<br>' +
      '<br>' +
      'document`END`PUN.`END`PLNwriteln`END`PUN(`END`PLNfib`END`PUN(`END' +
          '`LIT10`END`PUN));`END`PLN<br>' +
      '`END`COM// --&gt;`END`PLN<br>' +
      '&nbsp; &nbsp; `END`END`TAG&lt;/script&gt;`END`PLN<br>' +
      '&nbsp; `END`TAG&lt;/body&gt;`END`PLN<br>' +
      '`END`TAG&lt;/html&gt;`END')
};


function runTests() {
  /** number of characters in common at the end up to max. */
  function commonPrefix(a, b) {
    var n = Math.min(a.length, b.length);
    var i;
    for (i = 0; i < n; ++i) {
      if (a.charAt(i) !== b.charAt(i)) { break; }
    }
    return i;
  }

  /** number of characters in common at the end up to max. */
  function commonSuffix(a, b, max) {
    var n = Math.min(a.length - max, b.length - max);
    var i;
    for (i = 0; i < n; ++i) {
      if (a.charAt(a.length - i - 1) !== b.charAt(b.length - i - 1)) { break; }
    }
    return i;
  }

  /** convert a plain text string to html by escaping html special chars. */
  function html(plainText) {
    return plainText.replace(/\046/g, '&amp;')
        .replace(/\074/g, '&lt;')
        .replace(/\076/g, '&gt;')
        .replace(/\042/g, '&quot;')
        .replace(/\xa0/g, '&nbsp;');
  }

  /** convert a plain text string to html by escaping html special chars. */
  function htmlDQSafe(plainText) {
    return plainText.replace(/\046/g, '&amp;')
        .replace(/\074/g, '&lt;')
        .replace(/\076/g, '&gt;')
        .replace(/\xa0/g, '&nbsp;');
  }

  /**
   * get normalized markup.  innerHTML varies enough across browsers that we
   * can't use it.
   */
  function normalizedInnerHtml(node, opt_out) {
    var out = [];
    for (var child = node.firstChild; child; child = child.nextSibling) {
      normalizedHtml(child, out);
    }
    return out.join('');
  }
  function normalizedHtml(node, out) {
    switch (node.nodeType) {
      case 1:  // an element
        var name = node.tagName.toLowerCase();
        out.push('\074', name);
        for (var i = 0; i < node.attributes.length; ++i) {
          var attr = node.attributes[i];
          if (!attr.specified) { continue; }
          out.push(' ');
          normalizedHtml(attr, out);
        }
        out.push('>');
        for (var child = node.firstChild; child; child = child.nextSibling) {
          normalizedHtml(child, out);
        }
        if (node.firstChild || !/^(?:br|link|img)$/.test(name)) {
          out.push('<\/', name, '>');
        }
        break;
      case 2: // an attribute
        out.push(node.name.toLowerCase(), '="', htmlDQSafe(node.value), '"');
        break;
      case 3: case 4: // text
        out.push(htmlDQSafe(node.nodeValue));
        break;
    }
  }

  var htmlOut = [];
  var failures = 0;
  document.getElementById('errorReport') = '<h1>Running tests&hellip;<\/h1>';
  htmlOut.push('<h1>Test results<\/h1>');
  for (var lang in goldens) {
    var golden = goldens[lang].replace(/`([A-Z]{3})/g, function (_, lbl) {
        return (lbl == 'END'
            ? '<\/span>'
            : '<span class="' + lbl.toLowerCase() + '">');
      });
    var actual = normalizedInnerHtml(document.getElementById(lang));
    if (golden !== actual) {  // test failed
      // write out
      var pre = commonPrefix(golden, actual);
      var post = commonSuffix(golden, actual, pre);

      ++failures;
      htmlOut.push('<h2>' + html(lang) + ' Failed<\/h1>');
      htmlOut.push(
          '<tt>' + html(golden.substring(0, pre)) +
          '&raquo;<span class="mismatch">' +
          html(golden.substring(pre, golden.length - post)) +
          '<\/span>&laquo;' +
          html(golden.substring(golden.length - post)) +

          '<br>!==<br>' +

          html(actual.substring(0, pre)) +
          '&raquo;<span class="mismatch">' +
          html(actual.substring(pre, actual.length - post)) +
          '<\/span>&laquo;' +
          html(actual.substring(actual.length - post)) + '<\/tt>');
    } else {
      htmlOut.push('<h2>' + html(lang) + ' OK<\/h1>');
    }
  }
  htmlOut.push('<h2>' + (failures ? (failures + ' test(s) failed') : 'Pass') +
               '<\/h2>');
  document.getElementById('errorReport').innerHTML =
      htmlOut.join('').replace(/&lt;br&gt;/g, '&lt;br&gt;\n');
}
</script>

</html>
